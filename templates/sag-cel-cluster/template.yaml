alias: sag-cel-cluster
description: Event Data Store (CEL) provisioning and cluster configuration

environments:
  default:
    release.major:    10                                                   # release major version number
    os.platform:      lnxamd64                                             # OS platform code: w64|lnxamd64|osx 
    nodes:            [dev1, dev2]              
    cel.port:         9340
    cel.fixes:        []
layers:
  runtime:
    productRepo:      ${repo.product}
    fixRepo:          ${repo.fix}
    templates:        cel-cluster-${runtime.nodes.count}
templates:
  cel-cluster-1:
    fixes: ${cel.fixes}
    products:
      CEL:
  cel-cluster-2:
    fixes: ${cel.fixes}
    products:
      CEL:
        default:
          configuration:
            CEL:
              COMMON-CLUSTER:
                COMMON-CLUSTER-default:
                  Enabled: 'true'
                  Name: SAG_EventDataStore
                  Servers:
                    Server:
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[1]}
                        - '@name': port
                          $: ${cel.port}
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[2]}
                        - '@name': port
                          $: ${cel.port} 
              CUSTOM-PROPERTIES:
                CUSTOM-PROPERTIES-default: |
                  path.logs: "/var/elk/logs"
                  discovery.zen.minimum_master_nodes: ${runtime.nodes.count}
                  node.master: true
                  node.data: true
  cel-cluster-3:
    fixes: ${cel.fixes}
    products:
      CEL:
        default:
          configuration:
            CEL:
              COMMON-CLUSTER:
                COMMON-CLUSTER-default:
                  Enabled: 'true'
                  Name: SAG_EventDataStore
                  Servers:
                    Server:
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[1]}
                        - '@name': port
                          $: ${cel.port}
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[2]}
                        - '@name': port
                          $: ${cel.port}     
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[3]}
                        - '@name': port
                          $: ${cel.port}                                              
              CUSTOM-PROPERTIES:
                CUSTOM-PROPERTIES-default: |
                  path.logs: "/var/elk/logs"
                  discovery.zen.minimum_master_nodes: ${runtime.nodes.count}
                  node.master: true
                  node.data: true
provision:
  default:
    runtime: ${nodes}
